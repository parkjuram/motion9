{% extends "web_base.html" %}

{% load static %}
{% load humanize %}
{% load mathfilters %}

{% block header %}
    <meta content="" name="description"/>
    <meta content="" name="author"/>

    <link href="{% static 'metronic_assets/global/css/components.css' %}" id="style_components" rel="stylesheet"
          type="text/css"/>
    <link href="{% static 'metronic_assets/global/css/plugins.css' %}" id="style_components" rel="stylesheet"
          type="text/css"/>
    <link href="{% static 'metronic_assets/admin/layout4/css/layout.css' %}" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}"/>

    {% block common_style_css %}
        <link rel="stylesheet" href="{% static "css/report_style_web.css" %}"/>
    {% endblock %}

    <script type="text/javascript">
        var urlForDoInterest = "{% url 'do_interest_product' %}";
        var urlForUndoInterest = "{% url 'undo_interest_product' %}";
        var urlForSurveyAgain = "{% url 'survey_again' %}";
    </script>

{% endblock %}

{% block content %}


    <div class="modal fade" id="responsive" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></div>
                    <h4 class="modal-title" id="myModalLabel">재분석 요청</h4>

                    <div>분석이 완료되면 알림을 받을 수 있도록 옐로아이디를 등록해주세요</div>
                </div>
                <div class="modal-body">
                    <div class="lise-title">
                        재분석 요청 항목
                    </div>
                    <div class="form-group">
                        <div class="col-xs-12">
                            <div class="checkbox">
                                <input type="checkbox">
                                <span>전체 보고서 다시 요청</span>
                            </div>
                        </div>
                        {% for category in categories %}
                            {% if forloop.counter0 == 0 %}
                                <div class="col-xs-6">
                                    <div class="checkbox">
                                        <label>
                                            <input class="again-item" type="checkbox" value="{{ category.name }}"><span>{{ category.name_for_kor }}</span>
                                        </label>
                            {% elif forloop.counter0 == 4 %}
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="checkbox">
                                        <label>
                                            <input class="again-item" type="checkbox" value="{{ category.name }}"><span>{{ category.name_for_kor }}</span>
                                        </label>
                            {% elif forloop.last %}
                                        <label>
                                            <input class="again-item" type="checkbox" value="{{ category.name }}"><span>{{ category.name_for_kor }}</span>
                                        </label>
                                    </div>
                                </div>
                            {% else %}
                                         <label>
                                            <input class="again-item" type="checkbox" value="{{ category.name }}"><span>{{ category.name_for_kor }}</span>
                                        </label>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <div class="lise-title">
                        요청 이유
                    </div>
                    <div class="col-xs-12">
                        <textarea id="text-reason" class="form-control" rows="3">ex)추천된 로션은 유분기가 많아서 저에게 안맞는거 같아요</textarea>
                    </div>
                    <div class="lise-title">
                        추가 요청 사항
                    </div>
                    <div class="col-xs-12">
                        <textarea id="text-comments" class="form-control" rows="3">ex)폴라초이스 제품 위주로 추천해주세</textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <div type="button" class="btn btn-default" data-dismiss="modal">취소</div>
                    <div type="button" class="btn btn-primary btn-survey-again" user-survey-id="{{ request.pk }}" data-dismiss="modal">재분석 요청</div>
                </div>
            </div>
        </div>
    </div>


    <body style="background-color:#e6e9f2;">

    <!-- Modal -->


    <div class="clearfix"></div>
    <div class="page-container margin-top-40">
        <div class="page-content">
            <div class="page-head" style="margin-bottom:10px;">
                <div class="page-title">
                    <h1>{{ user_survey_result.created|date:"Y년 m월 d일 보고서" }}</h1>
                    {#<small>부제목</small>#}
                </div>
                <div class="page-toolbar">
                    <div type="button" class="btn btn-lg red"
                         style="background-color: #c63927 !important; font-size:14px; color:#FFFFFF !important;"
                         data-toggle="modal" data-target="#responsive">
                        재분석 요청
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 col-sm-6 col-xs-6">
                    <div class="wrapper">
                        <div class="portlet light">
                            <div class="portlet-title">
                                <div class="caption caption-md">
                                    <i class="icon-bar-chart theme-font-color hide"></i>
                                    <span class="caption-subject theme-font-color bold uppercase">분석 총평</span>
                                </div>
                            </div>
                            <div class="portlet-body total-review">
                                {{ user_survey_result.general_review }}
                            </div>
                            <div id="sales_statistics" class="portlet-body-morris-fit morris-chart"
                                 style="height: 260px; display:none;">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-sm-6 col-xs-6">
                    <div class="wrapper">
                        <div class="portlet light ">
                            <div class="portlet-title">
                                <div class="caption caption-md">
                                    <i class="icon-bar-chart theme-font-color hide"></i>
                                    <span class="caption-subject theme-font-color bold uppercase">예산</span>
                                </div>
                            </div>
                            <div class="portlet-body">
                                <h4>예산은 {{ user_survey_result.budget_min|intcomma }}
                                    ~ {{ user_survey_result.budget_max|intcomma }}원 입니다.</h4>

                                <div id="chart_7" style="width: 90%; height:250px; font-size:14px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% for key, value in survey_result_detail.items %}
                {% if forloop.counter0|divisibleby:2 %}
                    {% ifnotequal forloop.count0 0 %}

                        <div class="row">
                    {% else %}
                        <div class="row">
                    {% endifnotequal %}
                {% endif %}

                <div class="col-md-6 col-sm-6 col-xs-6">
                    <div class="wrapper-title">

                            <div class="col-md-4">
                                <div class="number">{{ value.0.product.category.name_for_kor }}
                                </div>
                            </div>
                            <a href="{% url "survey2_result_detail" pk=request.pk product_type=key %}" target="_self">
                            <div class="col-md-8" id="view_report">
                                <div type="button" class="more">분석 보고서 보기  ❯
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="wrapper-item">
                        {% for item in value %}
                            <div class="col-xs-6" style="padding-left: 5px; padding-right: 5px;">
                                <a href="{% url "survey2_result_detail" pk=request.pk product_type=key %}" target="_self">
                                    <div class="dashboard-stat2" style="padding-bottom:5px; margin-bottom:0px;">
                                        <div class="row">
                                            <div class="col-xs-12"
                                                 style="padding-right:5px; padding-left: 5px; text-align: center;">

                                                <img src="{% static 'img/test.jpg' %}" alt=""
                                                     style="width:100px; margin: 0 auto;"/>

                                            </div>
                                            <div>
                                                <div class="display">
                                                    <div class="number">
                                                    <span class="font-blue"
                                                            >{{ item.product.name }}</span></br>
                                                        <div class="detail">
                                                            <span>{{ item.product.price|intcomma }}원/{{ item.product.capacity }}{{ item.product.capacity_unit }}</span><br/>
                                                            <span>({{ item.product.unit_price }}원/{{ item.product.capacity_unit }})</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                                <a href="#" class="btn blue btn-interest"
                                   product-id="{{ item.product.id }}"
                                   user-survey-id="{{ request.pk }}"
                                   style="width: 100%;">
                                    {% if item.product.is_interested %}
                                        관심완료
                                    {% else %}
                                        관심하기
                                        <i class="fa fa-plus"></i>
                                    {% endif %}
                                </a>
                            </div>

                        {% endfor %}
                    </div>
                <!-- END PAGE TITLE -->
                </div>
            {% endfor %}
            </div>


            <!-- END PAGE CONTENT INNER -->

            <!-- END CONTENT -->
            </div>
    </div>
    </div>
        <!-- END CONTAINER -->
        <!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
        <!-- BEGIN CORE PLUGINS -->
        <!--[if lt IE 9]>
	<script src="{% static 'metronic_assets/global/plugins/respond.min.js' %}"></script>
	<script src="{% static 'metronic_assets/global/plugins/excanvas.min.js' %}"></script>

	<![endif]-->

        <script src="{% static 'metronic_assets/global/plugins/bootstrap/js/bootstrap.min.js' %}"
                type="text/javascript"></script>
        <script src="{% static 'metronic_assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js' %}"
                type="text/javascript"></script>
        <script src="{% static 'metronic_assets/global/scripts/metronic.js' %}" type="text/javascript"></script>
        <script src="{% static 'metronic_assets/global/plugins/amcharts/amcharts/amcharts.js' %}"></script>
        <script src="{% static 'metronic_assets/global/plugins/amcharts/amcharts/pie.js' %}"></script>

        <script>
            jQuery(document).ready(function () {
                Metronic.init(); // init metronic core componets

                var chart_data = {{ chart_data|safe }};
                for( var item in chart_data ) {
                    chart_data[item]['category'] = decodeURIComponent(escape(chart_data[item]['category']));
                }

                var chart = AmCharts.makeChart("chart_7", {
                            "type": "pie",
                            "pathToImages": "http://cdn.amcharts.com/lib/3/images/",
                            "angle": 12,
                            "balloonText": "[[title]]<br><span style='font-size:14px'><b>[[value]]원</b> ([[percents]]%)</span>",
                            "depth3D": 10,
                            "radius": 70,
                            "baseColor": "#7070FF",
                            "labelTickAlpha": 0.63,
                            "marginBottom": 0,
                            "marginTop": 0,
                            "pullOutEffect": "elastic",
                            "startEffect": "easeOutSine",
                            "titleField": "category",
                            "valueField": "column-1",
                            "handDrawScatter": 0,
                            "handDrawThickness": 0,
                            "allLabels": [],
                            "balloon": {},
                            "legend": {
                                "align": "center",
                                "markerType": "circle",
                                "valueText": "[[value]]원"
                            },
                            "titles": [],
                            "dataProvider": chart_data
                        }
                );


                $('.total-review').slimScroll({

                    height: '250px',
                    railVisible: true,
                    alwaysVisible: true
                });
            });
        </script>

        <script src="{% static 'user/js/interest_product.js' %}"></script>
        <script src="{% static 'user/js/survey.js' %}"></script>

    </body>


{% endblock %}
